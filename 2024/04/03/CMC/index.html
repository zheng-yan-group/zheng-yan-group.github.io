<!DOCTYPE html>
<html lang="en">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Yan&#39;s group</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="Yan&#39;s group" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2024/04/03/CMC/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2024-04-03T03:54:50.189Z" />
  
  <meta property="og:article:author" content="Yiming Ding" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Yan&#39;s group</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/research">Research</a>
            
            
            
            <a class="nav-item" href="/people">People</a>
            
            
            
            <a class="nav-item" href="/publications">Publications</a>
            
            
            
            <a class="nav-item" href="/teaching">Teaching</a>
            
            
            
            <a class="nav-item" href="/gallery">Gallery</a>
            
            
            
            <a class="nav-item" href="/join">Join us</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        

        

        <h2 class="title"></h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="Classical-Monte-Carlo-Simulations-for-the-2D-Ising-Model-and-Wolff-Algorithm"><a href="#Classical-Monte-Carlo-Simulations-for-the-2D-Ising-Model-and-Wolff-Algorithm" class="headerlink" title="Classical Monte Carlo Simulations for the 2D Ising Model and Wolff Algorithm"></a>Classical Monte Carlo Simulations for the 2D Ising Model and Wolff Algorithm</h1><h2 id="1-Classical-Monte-Carlo-Simulations-for-the-2D-Ising-Model"><a href="#1-Classical-Monte-Carlo-Simulations-for-the-2D-Ising-Model" class="headerlink" title="1. Classical Monte Carlo Simulations for the 2D Ising Model"></a>1. Classical Monte Carlo Simulations for the 2D Ising Model</h2><p><strong>Model</strong><br>The Hamiltonian of Ising model is written as<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mtd id="mjx-eqn:16"></mtd><mtd><mi>H</mi><mo>&#x3D;</mo><mo>&#x2212;</mo><mi>J</mi><munder><mo data-mjx-texclass="OP">&#x2211;</mo><mrow data-mjx-texclass="ORD"><mo fence="false" stretchy="false">&#x27E8;</mo><mi>i</mi><mi>j</mi><mo fence="false" stretchy="false">&#x27E9;</mo></mrow></munder><msub><mi>s</mi><mi>i</mi></msub><msub><mi>s</mi><mi>j</mi></msub></mtd></mtable></math><br>where <math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">&#x27E8;</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo fence="false" stretchy="false">&#x27E9;</mo></math> sums over all nearest-neighbor pairs on the lattice and each site <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math> has a spin variable <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3C3;</mi><mrow data-mjx-texclass="ORD"><mi>i</mi></mrow></msub></math> that can take two values: +1 (representing an up spin <math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">|</mo><mo stretchy="false">&#x2191;</mo><mo fence="false" stretchy="false">&#x27E9;</mo></math>) or -1 (representing a down spin <math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">|</mo><mo stretchy="false">&#x2193;</mo></math>). The behavior of the model is determined by the competition between the interaction energy and the thermal fluctuations. At low temperatures, the system will exhibit ferromagnetic order, where all spins align in the same direction. At high temperatures, the system will exhibit disordered behavior, where the spins are randomly aligned. Therefore, it is expected that there may exist a finite-temperature phase transition in this model. This classical model despite its simpleness provides us with profound insights into the behavior of magnets through its concise mathematical structure and important physical properties.</p>
<p><strong>Markov chain Monte Carlo simulation</strong></p>
<p>Given a discrete probability distribution <math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="false" stretchy="false">}</mo></math>, the expectation value of the observable <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math> is given by<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo fence="false" stretchy="false">&#x27E8;</mo><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="false" stretchy="false">&#x27E9;</mo><mo>&#x3D;</mo><munder><mo data-mjx-texclass="OP">&#x2211;</mo><mrow data-mjx-texclass="ORD"><mi>x</mi></mrow></munder><mi>p</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mrow data-mjx-texclass="ORD"><mi>x</mi></mrow><mo stretchy="false">)</mo></math><br>However, this may be expensive or even non-available when the value range of <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math> is huge. </p>
<p>One alternative way to address it is sampling, which gives an approximate estimation of <math xmlns="http://www.w3.org/1998/Math/MathML" ><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math>. To be specific, if we can generate different samples (configurations) of $x$ according to their corresponding probabilities, and sample <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math> for <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math> times, then the weak law of large numbers guarantees that<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo fence="false" stretchy="false">&#x27E8;</mo><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="false" stretchy="false">&#x27E9;</mo><mo>&#x3D;</mo><munder><mo data-mjx-texclass="OP" movablelimits="true">lim</mo><mrow data-mjx-texclass="ORD"><mi>N</mi><mo accent="false" stretchy="false">&#x2192;</mo><mi mathvariant="normal">&#x221E;</mi></mrow></munder><mfrac><mn>1</mn><mi>N</mi></mfrac><munder><mo data-mjx-texclass="OP">&#x2211;</mo><mi>j</mi></munder><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">O</mi></mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo></math><br>where <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>j</mi></msub></math> is our <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math>th sample. </p>
<p>The Monte Carlo (MC) simulation is basically to generate different samples on computer with some pseudo random number generator and calculate the observable. One of the popular ways to generate samples is to use the Markov chain, and this kind of MC is also called the Markov chain Monte Carlo (MCMC).</p>
<p>Mathematically, the Markov chain means the (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>+</mo><mn>1</mn></math>)th sample <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></math> only depends on the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math>th sample <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>n</mi></msub></math> and some random term <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3BE;</mi><mi>n</mi></msub></math> for generating samples, i.e.</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>&#x3D;</mo><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo>,</mo><msub><mi>&#x3BE;</mi><mi>n</mi></msub><mo stretchy="false">)</mo></math><br>the master equation for this stochastic process is thus </p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo><mo>&#x3D;</mo><munder><mo data-mjx-texclass="OP">&#x2211;</mo><mrow data-mjx-texclass="ORD"><msub><mi>x</mi><mi>n</mi></msub></mrow></munder><mi>&#x3C9;</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mi>n</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math><br> where <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mi>n</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></math> denote the probability that we obtain <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>n</mi></msub></math> as the <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math>th sample and<br> <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>&#x3C9;</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo></math> is the conditional probability to transfer from <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math> to <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup></math>. If we can expect a equilibrium on the Markov chain, i.e. <math xmlns="http://www.w3.org/1998/Math/MathML"><munder><mo data-mjx-texclass="OP" movablelimits="true">lim</mo><mrow data-mjx-texclass="ORD"><mi>n</mi><mo accent="false" stretchy="false">&#x2192;</mo><mi mathvariant="normal">&#x221E;</mi></mrow></munder><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mo>&#x3D;</mo><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub></math> then one brutal restriction is to require</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>&#x3C9;</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mi>&#x3C9;</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">|</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo></math><br>This constraint is called the detailed balance condition. If this can be satisfied, then the equilibrium must exists. </p>
<p>There are many ways to satisfy it, and we consider the Metropolis-Hasting algorithm here. First we rewrite<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>&#x3C9;</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mi>T</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mi>A</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo></math><br>where <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo></math> is a defined trial probability. <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo></math> is called the acceptance probability and is defined as<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mo data-mjx-texclass="OP" movablelimits="true">min</mo><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">{</mo></mrow><mn>1</mn><mo>,</mo><mfrac><mrow><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">|</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo></mrow><mrow><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>T</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">}</mo></mrow></math><br>If <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">|</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo></math>, one can check that the detailed balance condition is naturally satisfied. Otherwise, we should further determine the functional form of $T(x’|x)$. As we will see later, in our simulation for the Ising model, we can make <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">|</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo></math> throughout the simulations, therefore<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><mo data-mjx-texclass="OP" movablelimits="true">min</mo><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">{</mo></mrow><mn>1</mn><mo>,</mo><mfrac><mrow><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mo data-mjx-alternate="1">&#x2032;</mo></msup><mo stretchy="false">)</mo></mrow><mrow><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">}</mo></mrow></math><br>Another important thing for a MCMC scheme is the ergodicity, i.e. we have to make sure that for any possible <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math>, we can sample it from the Markov chain in a finte (discrete) time <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math>. However, this may not be easy to prove in some cases. </p>
<p><strong>MCMC on the Ising model</strong><br>With MCMC, we can now calculate the expectation values of observables such as energy of the Ising model by sampling different configurations (classical states). At the equilibrium, the probability distribution for different configurations <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3B1;</mi><mi>j</mi></msub></math> obeys the Boltzmann distribution</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow data-mjx-texclass="ORD"><mi data-mjx-variant="-tex-calligraphic" mathvariant="script">P</mi></mrow><mrow data-mjx-texclass="ORD"><mtext>eq</mtext></mrow></msub><mo stretchy="false">(</mo><msub><mi>&#x3B1;</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>&#x3D;</mo><mfrac><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>&#x2212;</mo><msub><mi>E</mi><mi>j</mi></msub><mrow data-mjx-texclass="ORD"><mo>&#x2F;</mo></mrow><msub><mi>k</mi><mrow data-mjx-texclass="ORD"><mi>b</mi></mrow></msub><mi>T</mi></mrow></msup><mrow><munder><mo data-mjx-texclass="OP">&#x2211;</mo><mi>j</mi></munder><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>&#x2212;</mo><msub><mi>E</mi><mi>j</mi></msub><mrow data-mjx-texclass="ORD"><mo>&#x2F;</mo></mrow><msub><mi>k</mi><mrow data-mjx-texclass="ORD"><mi>b</mi></mrow></msub><mi>T</mi></mrow></msup></mrow></mfrac></math><br>where <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>b</mi></msub></math> is the Boltzmann constant and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>E</mi><mi>j</mi></msub></math> is the energy corresponding to <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3B1;</mi><mrow data-mjx-texclass="ORD"><mi>j</mi></mrow></msub></math>. Suppose we have a configuration <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>n</mi></msub><mo>&#x3D;</mo><msub><mi>&#x3B1;</mi><mi>i</mi></msub></math> at time <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math>, then to generate a new configuration <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3B1;</mi><mrow data-mjx-texclass="ORD"><mi>j</mi></mrow></msub></math>, we randomly choose one spin and flip it. Therefore, <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo stretchy="false">(</mo><msub><mi>&#x3B1;</mi><mi>j</mi></msub><mo stretchy="false">|</mo><msub><mi>&#x3B1;</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&#x3D;</mo><mi>T</mi><mo stretchy="false">(</mo><msub><mi>&#x3B1;</mi><mi>i</mi></msub><mo stretchy="false">|</mo><msub><mi>&#x3B1;</mi><mi>j</mi></msub><mo stretchy="false">)</mo></math> is satisfied and for <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3B1;</mi><mi>i</mi></msub></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>&#x3B1;</mi><mrow data-mjx-texclass="ORD"><mi>j</mi></mrow></msub></math>, the acceptance probability reduces to<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mo stretchy="false">(</mo><msub><mi>&#x3B1;</mi><mi>j</mi></msub><mo stretchy="false">|</mo><msub><mi>&#x3B1;</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&#x3D;</mo><mo data-mjx-texclass="OP" movablelimits="true">min</mo><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">{</mo></mrow><mn>1</mn><mo>,</mo><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>&#x2212;</mo><mi mathvariant="normal">&#x394;</mi><mi>E</mi><mrow data-mjx-texclass="ORD"><mo>&#x2F;</mo></mrow><mi>k</mi><mi>T</mi></mrow></msup><mrow data-mjx-texclass="ORD"><mo minsize="2.047em" maxsize="2.047em">}</mo></mrow></math><br>where <math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">&#x394;</mi><mi>E</mi><mo>&#x3D;</mo><msub><mi>E</mi><mi>j</mi></msub><mo>&#x2212;</mo><msub><mi>E</mi><mi>i</mi></msub></math>. It means that if the new configuration has a lower energy (<math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">&#x394;</mi><mi>E</mi><mo>&lt;</mo><mn>0</mn></math>), then we accept it with 100% probability to assign <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>&#x3D;</mo><msub><mi>&#x3B1;</mi><mi>j</mi></msub></math>. Otherwise, we accept it with probability equal to <math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>&#x2212;</mo><mi mathvariant="normal">&#x394;</mi><mi>E</mi><mrow data-mjx-texclass="ORD"><mo>&#x2F;</mo></mrow><mi>k</mi><mi>T</mi></mrow></msup></math>. It is straightforward that the single-flip strategy enable us to reach every possible configuration and the ergodicity can be saitisfied. </p>
<p>Practically, we have to assign an initial configuration, which could be <math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">|</mo><mo stretchy="false">&#x2191;&#x2191;</mo><mo>&#x22EF;</mo><mo stretchy="false">&#x2191;</mo><mo fence="false" stretchy="false">&#x27E9;</mo></math> or any random one. In low-temperature case, the initial state configuration may be some high-level excited state, which has small probability to appear statistically. Consequently, if we do measurements at the beginning, it will introduce errors since the initial states are out of equilibrium. Therefore, we first take <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mrow data-mjx-texclass="ORD"><mtext>Thm</mtext></mrow></msub></math> steps for thermalizing the system, then do measurements for <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mrow data-mjx-texclass="ORD"><mtext>Stat</mtext></mrow></msub></math> times. </p>
<p><strong>Observables</strong><br>To investigate the property of the Ising model, several observables are measured. In the case of the ferromagnetic Ising model,the most important quantity to calculate is the magnetization. It should be computed using all the spins to take advantage of self-averaging to improve the statistics，which is<br><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>m</mi><mo>&#x3D;</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mi>N</mi></mfrac></mstyle><munderover><mo data-mjx-texclass="OP">&#x2211;</mo><mrow data-mjx-texclass="ORD"><mi>i</mi><mo>&#x3D;</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>&#x3C3;</mi><mi>i</mi></msub></math><br>At low temperature, two spin configurations <math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">|</mo><mo stretchy="false">&#x2191;</mo><mo>&#x22EF;</mo><mo stretchy="false">&#x2191;</mo><mo fence="false" stretchy="false">&#x27E9;</mo></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">|</mo><mo stretchy="false">&#x2193;</mo><mo>&#x22EF;</mo><mo stretchy="false">&#x2193;</mo><mo fence="false" stretchy="false">&#x27E9;</mo></math> lead to <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mo>&#x3D;</mo><mo>+</mo><mn>1</mn></math> and <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mo>&#x3D;</mo><mo>&#x2212;</mo><mn>1</mn></math> respectively. Therefore we can take <math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">&#x27E8;</mo><mo stretchy="false">|</mo><mi>m</mi><mo stretchy="false">|</mo><mo fence="false" stretchy="false">&#x27E9;</mo></math> to detect the phase transition.</p>
<p>Another observable is magnetic susceptibility, which describes the response of a material to an external magnetic field, and it measures the degree of magnetization of a material under the action of a magnetic field. The magnetic susceptibility is usually indicated by the symbol <math xmlns="http://www.w3.org/1998/Math/MathML"><mi>&#x3C7;</mi></math>, which is defined as</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>&#x3C7;</mi><mo>&#x3D;</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mi>N</mi><mi>T</mi></mfrac></mstyle><mo stretchy="false">(</mo><mrow data-mjx-texclass="ORD"><mo fence="false" stretchy="false">&#x27E8;</mo><msup><mi>m</mi><mn>2</mn></msup><mo fence="false" stretchy="false">&#x27E9;</mo></mrow><mo>&#x2212;</mo><msup><mrow data-mjx-texclass="ORD"><mo fence="false" stretchy="false">&#x27E8;</mo><mo stretchy="false">|</mo><mi>m</mi><mo stretchy="false">|</mo><mo fence="false" stretchy="false">&#x27E9;</mo></mrow><mn>2</mn></msup><mo stretchy="false">)</mo></math></p>
<p>Magnetic susceptibility plays an important role in material research and application. By measuring the magnetic susceptibility, we can understand the magnetic properties, phase transition behavior and magnetic permeability of the material. Magnetic susceptibility is also closely related to physical phenomena such as magnetic interaction, spin structure and magnetic field effect of materials.</p>
<p>Binder ratio is a dimensionless physical quantity used to characterize scale invariance in phase transitions. Near the critical point of the phase transition, it can be used to measure the statistical characteristics of the magnetization of systems of different sizes. It can be defined as</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>R</mi><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow></msub><mo>&#x3D;</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mo fence="false" stretchy="false">&#x27E8;</mo><msup><mi>m</mi><mn>4</mn></msup><mo fence="false" stretchy="false">&#x27E9;</mo></mrow><mrow><mo fence="false" stretchy="false">&#x27E8;</mo><msup><mi>m</mi><mn>2</mn></msup><msup><mo fence="false" stretchy="false">&#x27E9;</mo><mn>2</mn></msup></mrow></mfrac></mstyle></math></p>
<p>where <math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">&#x27E8;</mo><msup><mi>m</mi><mn>2</mn></msup><mo fence="false" stretchy="false">&#x27E9;</mo></math> is the second moment representing the magnetization and <math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">&#x27E8;</mo><msup><mi>m</mi><mn>4</mn></msup><mo fence="false" stretchy="false">&#x27E9;</mo></math> is the fourth moment of magnetization. At <math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>C</mi></msub></math>, the power-laws cancel out, and the ratio is L-independent (and also universal), up to sub-leading finite-size corrections.</p>
<p>The Binder ratio can be used to determine whether the system has undergone a phase transition near the phase transition point. When the system is in an ordered phase, the Binder ratio tends to 1, and when the system is in a disordered phase, the Binder ratio tends to some constant (usually much less than 1). By calculating the Binder ratio of a system of different sizes and observing whether it converges, it is possible to determine whether the system has a phase transition.</p>
<p>Binder Cumulant is a statistical physical quantity used to study the behavior of phase transitions, often used to describe isotropic magnetic systems or other phase transitions. This physical quantity is proposed in order to determine whether a phase transition occurs in a system and to estimate the position of the phase transition point in numerical simulation.In the case of a scalar order parameter (e.g., for the Ising model), the Binder cumulant is defined as</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>U</mi><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow></msub><mo>&#x3D;</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>2</mn><mn>3</mn></mfrac></mstyle><mo stretchy="false">(</mo><mn>1</mn><mo>&#x2212;</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mn>3</mn></mfrac></mstyle><msub><mi>R</mi><mrow data-mjx-texclass="ORD"><mn>2</mn></mrow></msub><mo stretchy="false">)</mo></math></p>
<p>The main characteristic of the Binder cumulant is that it tends to a constant near the point of the phase transition and to a different value in the non-phase transition region. By observing the change of Binder cumulants with temperature or other external parameters, the phase transition points can be well determined.</p>
<h2 id="2-Program"><a href="#2-Program" class="headerlink" title="2. Program"></a>2. Program</h2><p>The following is the program of the classical monte carlo simulations for the 2D Ising Model in fortran 90.</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">Module</span> configuration</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">save</span></span><br><span class="line"><span class="keyword">integer</span> :: L <span class="comment">! system size</span></span><br><span class="line"><span class="keyword">integer</span> :: N <span class="comment">! total number of sites</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: beta <span class="comment">! inverse temperature</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: Temperature <span class="comment">! temperature </span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">allocatable</span> :: conf(:,:) <span class="comment">! store Ising configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">Module</span> configuration</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">Module</span> measurement</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">save</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: E <span class="comment">! energy</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: sz <span class="comment">! magnetization</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: sz2 <span class="comment">! magnetization squared </span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: sz4 <span class="comment">! magnetization to the fourth power</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: Sus <span class="comment">! susceptibility</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: Binder <span class="comment">! binder cumulant</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">allocatable</span> :: den(:) <span class="comment">! density on each site</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">Module</span> measurement</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">Module</span> control</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">save</span></span><br><span class="line"><span class="keyword">integer</span> :: nbin <span class="comment">! number of bins</span></span><br><span class="line"><span class="keyword">integer</span> :: nsweep <span class="comment">! number of sweeps in one bin</span></span><br><span class="line"><span class="keyword">integer</span> :: nequil <span class="comment">! number of bins to reach equilbrium</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">Module</span> control</span><br><span class="line"></span><br><span class="line"><span class="comment">!==================================================!</span></span><br><span class="line"><span class="function"><span class="keyword">Program</span></span> IsingMC</span><br><span class="line"><span class="comment">!==================================================!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> Ising()</span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">program</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">!==================================================!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> Ising()</span><br><span class="line"><span class="comment">!==================================================!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">use</span> control</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">integer</span> :: nb,ns,ne</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> initran(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">call</span> initial()</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> <span class="keyword">while</span>(Temperature&lt;<span class="number">5.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">call</span> tcollect()</span><br><span class="line">    beta=<span class="number">1</span>/Temperature</span><br><span class="line"></span><br><span class="line">    <span class="keyword">call</span> initialconf()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> ne=<span class="number">1</span>,nequil</span><br><span class="line">        <span class="keyword">do</span> ns=<span class="number">1</span>,nsweep</span><br><span class="line">            <span class="keyword">call</span> update()</span><br><span class="line">        <span class="keyword">enddo</span></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> nb=<span class="number">1</span>,nbin</span><br><span class="line">        <span class="keyword">call</span> initialobser()</span><br><span class="line">        <span class="keyword">do</span> ns=<span class="number">1</span>,nsweep</span><br><span class="line">            <span class="keyword">call</span> measure()</span><br><span class="line">            <span class="keyword">call</span> update()</span><br><span class="line">        <span class="keyword">enddo</span></span><br><span class="line">        <span class="keyword">call</span> measureave()</span><br><span class="line">        <span class="keyword">call</span> output()</span><br><span class="line">    <span class="keyword">enddo</span></span><br><span class="line"></span><br><span class="line">    Temperature=Temperature+<span class="number">0.05</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> deallocateall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> Ising</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span></span> energy()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: energy</span><br><span class="line"><span class="keyword">integer</span> :: x,y</span><br><span class="line"><span class="keyword">integer</span> :: i1,i2,j3,j4</span><br><span class="line"></span><br><span class="line">energy=<span class="number">0.d0</span></span><br><span class="line"><span class="keyword">do</span> x=<span class="number">1</span>,L ; <span class="keyword">do</span> y=<span class="number">1</span>,L </span><br><span class="line"></span><br><span class="line">    i1=<span class="built_in">modulo</span>(x,L)+<span class="number">1</span></span><br><span class="line">    i2=<span class="built_in">modulo</span>(x-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line">    j3=<span class="built_in">modulo</span>(y,L)+<span class="number">1</span></span><br><span class="line">    j4=<span class="built_in">modulo</span>(y-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    energy=energy-conf(x,y)*(conf(i1,y)+conf(i2,y)+conf(x,j3)+conf(x,j4))</span><br><span class="line"><span class="keyword">enddo</span> ; <span class="keyword">enddo</span></span><br><span class="line">energy=energy/N </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Function</span></span> energy </span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span></span> energy_diff(i,j)</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: energy_diff</span><br><span class="line"><span class="keyword">integer</span> :: i,j</span><br><span class="line"><span class="keyword">integer</span> :: i1,i2,j3,j4</span><br><span class="line"></span><br><span class="line">i1=<span class="built_in">modulo</span>(i,L)+<span class="number">1</span></span><br><span class="line">i2=<span class="built_in">modulo</span>(i-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line">j3=<span class="built_in">modulo</span>(j,L)+<span class="number">1</span></span><br><span class="line">j4=<span class="built_in">modulo</span>(j-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">energy_diff=<span class="number">2</span>*conf(i,j)*(conf(i1,j)+conf(i2,j)+conf(i,j3)+conf(i,j4))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Function</span></span> energy_diff</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> initialconf()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">external</span> :: ran</span><br><span class="line"><span class="keyword">integer</span> :: i,j</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> i=<span class="number">1</span>,L ; <span class="keyword">do</span> j=<span class="number">1</span>,L</span><br><span class="line">    <span class="keyword">if</span>(ran()&gt;<span class="number">0.5d0</span>) <span class="keyword">then</span></span><br><span class="line">        conf(i,j)=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        conf(i,j)=-<span class="number">1</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">enddo</span> ; <span class="keyword">enddo</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> initialconf</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> initial()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">use</span> control</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">open(<span class="number">11</span>,<span class="keyword">file</span>=<span class="string">&#x27;para.in&#x27;</span>,<span class="keyword">status</span>=<span class="string">&#x27;old&#x27;</span>)</span><br><span class="line">read(<span class="number">11</span>,*) L</span><br><span class="line">read(<span class="number">11</span>,*) Temperature</span><br><span class="line">read(<span class="number">11</span>,*) nbin,nsweep,nequil</span><br><span class="line">close(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">N=L*L  </span><br><span class="line"></span><br><span class="line"><span class="built_in">allocate</span>(conf(L,L)) </span><br><span class="line"><span class="built_in">allocate</span>(den(N))</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> initial</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> initialobser()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"></span><br><span class="line">E=<span class="number">0.d0</span></span><br><span class="line">sz=<span class="number">0.d0</span></span><br><span class="line">sz2=<span class="number">0.d0</span></span><br><span class="line">sz4=<span class="number">0.d0</span></span><br><span class="line">Sus=<span class="number">0.d0</span></span><br><span class="line">Binder=<span class="number">0.d0</span></span><br><span class="line">den=<span class="number">0.d0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> initialobser</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> update()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">external</span> :: ran</span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">external</span> :: energy_diff</span><br><span class="line"><span class="keyword">integer</span> :: i,j</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> i=<span class="number">1</span>,L ; <span class="keyword">do</span> j=<span class="number">1</span>,L</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ran()&lt;<span class="built_in">min</span>(<span class="number">1.d0</span>,<span class="built_in">exp</span>(-beta*energy_diff(i,j)))) <span class="keyword">then</span></span><br><span class="line">        conf(i,j)= - <span class="number">1.d0</span> * conf(i,j)</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">enddo</span> ; <span class="keyword">enddo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> update</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> measure()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">integer</span> :: i,j</span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">external</span> :: energy</span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: sz_tmp</span><br><span class="line"></span><br><span class="line">E=E+energy()</span><br><span class="line"></span><br><span class="line">sz_tmp=<span class="number">0</span></span><br><span class="line"><span class="keyword">do</span> i=<span class="number">1</span>,L ; <span class="keyword">do</span> j=<span class="number">1</span>,L</span><br><span class="line">    sz_tmp=sz_tmp+conf(i,j)</span><br><span class="line"><span class="keyword">enddo</span> ; <span class="keyword">enddo</span></span><br><span class="line">sz=sz+<span class="built_in">abs</span>(sz_tmp/N)</span><br><span class="line">sz2=sz2+(sz_tmp/N)**<span class="number">2</span></span><br><span class="line">sz4=sz4+(sz_tmp/N)**<span class="number">4</span></span><br><span class="line"></span><br><span class="line">Sus=Sus+(sz2-sz**<span class="number">2</span>)/Temperature</span><br><span class="line">Binder=Binder+(<span class="number">1</span>-sz4/<span class="number">3</span>/(sz2**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> measure</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> measureave()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">use</span> control</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">E=E/nsweep</span><br><span class="line"></span><br><span class="line">sz=sz/nsweep</span><br><span class="line">sz2=sz2/nsweep</span><br><span class="line">sz4=sz4/nsweep</span><br><span class="line"></span><br><span class="line">Sus=N*(sz2-sz**<span class="number">2</span>)/Temperature</span><br><span class="line">Binder=(<span class="number">1</span>-sz4/<span class="number">3</span>/(sz2**<span class="number">2</span>))*<span class="number">3</span>/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> measureave</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> output()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"><span class="keyword">use</span> control</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">open(<span class="number">12</span>,<span class="keyword">file</span>=<span class="string">&#x27;energy.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">12</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(E)</span><br><span class="line">close(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">open(<span class="number">13</span>,<span class="keyword">file</span>=<span class="string">&#x27;M.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">13</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(sz)</span><br><span class="line">close(<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line">open(<span class="number">14</span>,<span class="keyword">file</span>=<span class="string">&#x27;M2.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">14</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(sz2)</span><br><span class="line">close(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">open(<span class="number">15</span>,<span class="keyword">file</span>=<span class="string">&#x27;M4.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">15</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(sz4)</span><br><span class="line">close(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">open(<span class="number">16</span>,<span class="keyword">file</span>=<span class="string">&#x27;Sus.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">16</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(Sus)</span><br><span class="line">close(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">open(<span class="number">17</span>,<span class="keyword">file</span>=<span class="string">&#x27;Binder.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">17</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(Binder)</span><br><span class="line">close(<span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> output</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> tcollect()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">open(<span class="number">18</span>,<span class="keyword">file</span>=<span class="string">&#x27;T.dat&#x27;</span>,<span class="keyword">position</span>=<span class="string">&#x27;append&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">18</span>,<span class="string">&#x27;((e16.8,2x))&#x27;</span>) <span class="built_in">dble</span>(Temperature)</span><br><span class="line">close(<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> tcollect</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> deallocateall()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">use</span> measurement</span><br><span class="line"></span><br><span class="line"><span class="built_in">deallocate</span>(conf)</span><br><span class="line"><span class="built_in">deallocate</span>(den)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> deallocateall</span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) <span class="function"><span class="keyword">function</span></span> ran()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="comment">! 64-bit congruental generator                     !</span></span><br><span class="line"><span class="comment">! iran64=oran64*2862933555777941757+1013904243     !</span></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>)    :: dmu64</span><br><span class="line"><span class="keyword">integer</span>(<span class="number">8</span>) :: ran64,mul64,add64</span><br><span class="line"><span class="keyword">common</span>/bran64/dmu64,ran64,mul64,add64</span><br><span class="line"></span><br><span class="line">ran64=ran64*mul64+add64</span><br><span class="line">ran=<span class="number">0.5d0</span>+dmu64*<span class="built_in">dble</span>(ran64)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">function</span></span> ran</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">subroutine</span></span> initran(w)</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">integer</span>(<span class="number">8</span>) :: irmax</span><br><span class="line"><span class="keyword">integer</span>(<span class="number">4</span>) :: w,nb,b</span><br><span class="line"></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>)    :: dmu64</span><br><span class="line"><span class="keyword">integer</span>(<span class="number">8</span>) :: ran64,mul64,add64</span><br><span class="line"><span class="keyword">common</span>/bran64/dmu64,ran64,mul64,add64</span><br><span class="line"></span><br><span class="line">irmax=<span class="number">2_8</span>**<span class="number">31</span></span><br><span class="line">irmax=<span class="number">2</span>*(irmax**<span class="number">2</span>-<span class="number">1</span>)+<span class="number">1</span></span><br><span class="line">mul64=<span class="number">2862933555777941757_8</span></span><br><span class="line">add64=<span class="number">1013904243</span></span><br><span class="line">dmu64=<span class="number">0.5d0</span>/<span class="built_in">dble</span>(irmax)</span><br><span class="line"></span><br><span class="line">open(<span class="number">10</span>,<span class="keyword">file</span>=<span class="string">&#x27;seed.in&#x27;</span>,<span class="keyword">status</span>=<span class="string">&#x27;old&#x27;</span>)</span><br><span class="line">read(<span class="number">10</span>,*)ran64</span><br><span class="line">close(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (w.ne<span class="number">.0</span>) <span class="keyword">then</span></span><br><span class="line">open(<span class="number">10</span>,<span class="keyword">file</span>=<span class="string">&#x27;seed.in&#x27;</span>,<span class="keyword">status</span>=<span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line"><span class="built_in">write</span>(<span class="number">10</span>,*)<span class="built_in">abs</span>((ran64*mul64)/<span class="number">5</span>+<span class="number">5265361</span>)</span><br><span class="line">close(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">subroutine</span></span> initran</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-Wolff-Algorithm"><a href="#3-Wolff-Algorithm" class="headerlink" title="3. Wolff Algorithm"></a>3. Wolff Algorithm</h2><p>The Metropolis algorithm with single spin inversion will suffer from critical slowing down when processing near the critical point. The critical region will form a large number of clusters or magnetic domains and the acceptance probability is very small. Effective inversion will only occur when picking to the boundary, so the correlation length between the two sampled configurations will be very large.</p>
<p>Therefore we use the classic cluster algorithm, wolff algorithm, to solve these problems. It works in the following way. </p>
<ol>
<li>Choose a random spin as the initial cluster. </li>
<li>If a neighboring spin is parallel to the initial spin it will be added to the cluster with probability <math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>&#x2212;</mo><msup><mi>e</mi><mrow data-mjx-texclass="ORD"><mo>&#x2212;</mo><mn>2</mn><mi>&#x3B2;</mi><mi>J</mi></mrow></msup></math>. </li>
<li>Repeat this step for all points newly added to the cluster and repeat this procedure until no new points can be added. </li>
<li>Perform measurements using improved estimators.</li>
<li>Flip all spins in the cluster.</li>
</ol>
<p>For the program, the only difference between the wolff algorithm and the single spin flip algorithm is the subroutine update. The subroutine update is modified as follows.</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="function"><span class="keyword">Subroutine</span></span> update()</span><br><span class="line"><span class="comment">!--------------------------------------------------!</span></span><br><span class="line"><span class="keyword">use</span> configuration</span><br><span class="line"><span class="keyword">implicit</span> <span class="keyword">none</span></span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>),<span class="keyword">external</span> :: ran</span><br><span class="line"><span class="keyword">integer</span> :: i,j,k,ii,jj</span><br><span class="line"><span class="keyword">integer</span> :: i1,i2,j3,j4</span><br><span class="line"><span class="keyword">integer</span> :: stack(L*L,<span class="number">2</span>),visited(L,L)</span><br><span class="line"><span class="keyword">integer</span> :: wi,wj,top</span><br><span class="line"><span class="keyword">real</span>(<span class="number">8</span>) :: p</span><br><span class="line"></span><br><span class="line">p=<span class="number">1</span>-<span class="built_in">exp</span>(-<span class="number">2</span>*beta)</span><br><span class="line"></span><br><span class="line">wi = <span class="built_in">min</span>(<span class="built_in">int</span>(ran()*L)+<span class="number">1</span>,L)</span><br><span class="line">wj = <span class="built_in">min</span>(<span class="built_in">int</span>(ran()*L)+<span class="number">1</span>,L)</span><br><span class="line"></span><br><span class="line">stack = <span class="number">0</span></span><br><span class="line">visited = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">top = <span class="number">1</span></span><br><span class="line">stack(top,<span class="number">1</span>) = wi</span><br><span class="line">stack(top,<span class="number">2</span>) = wj</span><br><span class="line"></span><br><span class="line">visited(wi,wj) = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> <span class="keyword">while</span>(top&gt;<span class="number">0</span>) </span><br><span class="line"></span><br><span class="line">    i = stack(top,<span class="number">1</span>)</span><br><span class="line">    j = stack(top,<span class="number">2</span>)</span><br><span class="line">    top = top-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    i1=<span class="built_in">modulo</span>(i,L)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ((conf(i1,j) == conf(i,j)) .and. (visited(i1,j) == <span class="number">1</span>) .and. ran()&lt;p) <span class="keyword">then</span></span><br><span class="line">        visited(i1,j) = -<span class="number">1</span></span><br><span class="line">        top = top+<span class="number">1</span></span><br><span class="line">        stack(top,<span class="number">1</span>) = i1</span><br><span class="line">        stack(top,<span class="number">2</span>) = j</span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">    i2=<span class="built_in">modulo</span>(i-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ((conf(i2,j) == conf(i,j)) .and. (visited(i2,j) == <span class="number">1</span>) .and. ran()&lt;p) <span class="keyword">then</span></span><br><span class="line">        visited(i2,j) = -<span class="number">1</span></span><br><span class="line">        top = top+<span class="number">1</span></span><br><span class="line">        stack(top,<span class="number">1</span>) = i2</span><br><span class="line">        stack(top,<span class="number">2</span>) = j</span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">    j3=<span class="built_in">modulo</span>(j,L)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ((conf(i,j3) == conf(i,j)) .and. (visited(i,j3) == <span class="number">1</span>) .and. ran()&lt;p) <span class="keyword">then</span></span><br><span class="line">        visited(i,j3) = -<span class="number">1</span></span><br><span class="line">        top = top+<span class="number">1</span></span><br><span class="line">        stack(top,<span class="number">1</span>) = i</span><br><span class="line">        stack(top,<span class="number">2</span>) = j3</span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">    j4=<span class="built_in">modulo</span>(j-<span class="number">2</span>,L)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> ((conf(i,j4) == conf(i,j)) .and. (visited(i,j4) == <span class="number">1</span>) .and. ran()&lt;p) <span class="keyword">then</span></span><br><span class="line">        visited(i,j4) = -<span class="number">1</span></span><br><span class="line">        top = top+<span class="number">1</span></span><br><span class="line">        stack(top,<span class="number">1</span>) = i</span><br><span class="line">        stack(top,<span class="number">2</span>) = j4</span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enddo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> i = <span class="number">1</span>,L; <span class="keyword">do</span> j = <span class="number">1</span>,L</span><br><span class="line">    <span class="keyword">if</span> (visited(i,j) == -<span class="number">1</span>) conf(i,j) = -conf(i,j)</span><br><span class="line"><span class="keyword">enddo</span>; <span class="keyword">enddo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> <span class="function"><span class="keyword">Subroutine</span></span> update</span><br></pre></td></tr></table></figure>


    </div>


    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Home</h2>
                
                <a href="/research" class="item">Research</a>
                
                <a href="/people" class="item">People</a>
                
                <a href="/publications" class="item">Publications</a>
                
                <a href="/teaching" class="item">Teaching</a>
                
                <a href="/gallery" class="item">Gallery</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Contact</h2>
                
                <a href="/join" class="item">Join us</a>
                
                <a href="mailto:zhengyan@westlake.edu.cn" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Powered by <a href="http://hexo.io/" target="_blank">Hexo-cupertino</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>